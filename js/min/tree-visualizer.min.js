!function(e){e.fn.treeVisualizer=function(t,n){function i(){var e=[],t=[],n=[];if(V.normalView){k.append('<div class="tree-visualizer" style="display: none"></div>'),m=k.children(".tree-visualizer");var i='<div class="tv-error" style="display: none"><p></p></div><div class="tree" style="font-size: '+V.nvFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside>';V.fsView&&(i+='<button class="tv-show-fs">Fullscreen</button>'),m.append(i),g=m.children(".tree"),y=m.children(".tooltip"),n.push(m),e.push(g),t.push(y)}if(V.fsView){k.append('<div class="tree-visualizer-fs" style="display: none"></div>'),v=k.children(".tree-visualizer-fs");var a="";V.normalView||(a+='<div class="tv-error" style="display: none"><p></p></div>'),a+='<div class="tree" style="font-size: '+V.fsFontSize+'px;"></div><aside class="tooltip" style="display: none"><ul></ul><button>&#10005;</button></aside><div class="zoom-opts"><button class="zoom-out">-</button><button class="zoom-default">Default</button><button class="zoom-in">+</button><button class="close">&#10005;</button></div>',v.append(a),w=v.children(".tree"),b=v.children(".tooltip"),x=v.children(".zoom-opts"),""!=V.sentence&&(w.before('<div class="sentence">'+decodeURI(V.sentence)+"</div>"),S=v.children(".sentence")),n.push(v),e.push(w),t.push(b)}z=u(e),C=u(t),anyView=u(n),errorContainer=anyView.children(".tv-error")}function a(t){e.ajax({type:"GET",url:t,dataType:"xml"}).done(function(e){null==e?h("Your XML appears to be empty or not in a compatible format."):o(e)}).fail(function(e){var t="";t=0===e.status?"Not connect to the Internet.<br>Verify your network connection.":404==e.status?"Requested XML file not found.<br>Try again with another query.":500==e.status?"Internal Server Error.<br>If the problem persists, contact us.":"Uncaught Error.<br>Please try again at another time.",h(t)}).always(function(){V.normalView&&m.show(),V.initFSOnClick&&(v.fadeIn(250),c())})}function o(t){var n=e(t);f(),z.html(s(n.find("node").first())),C.children("ul").empty(),d()}function s(t){var n=e("<ol/>");return t.each(function(t,i){for(var a=e('<li><a href="#"></a></li>'),o=0,d=i.attributes.length,r=null;d>o;o++)r=i.attributes[o],"highlight"==r.nodeName?a.addClass("highlight"):"begin"!=r.nodeName&&"end"!=r.nodeName&&a.attr("data-"+r.nodeName,r.value.replace(/^\s(.+)/g,"$1"));e(this).children("node").length&&a.append(s(e(this).children("node"))),n.append(a)}),n}function d(){z.find("a").each(function(){var t=e(this),n=t.parent("li");n.data("rel")&&(t.append("<span>"+n.data("rel")+"<span>"),n.data("index")&&t.append("<span>"+n.data("index")+"</span>")),n.data("postag")&&V.extendedPOS?t.append("<span>"+n.data("postag")+"</span>"):n.data("pt")?n.data("index")?t.children("span:last-child").append(":"+n.data("pt")):t.append("<span>"+n.data("pt")+"</span>"):n.data("cat")&&(n.data("index")?t.children("span:last-child").append(":"+n.data("cat")):t.append("<span>"+n.data("cat")+"</span>")),t.is(":only-child")&&(n.data("lemma")&&n.append("<span>"+n.data("lemma")+"</span>"),n.data("word")&&n.append("<span><em>"+n.data("word")+"</em></span>"),t.addClass("only-child"))}),z.find("li:only-child").addClass("only-child"),z.find("li:first-child").addClass("first-child"),z.find("li:last-child").addClass("last-child")}function r(){var e=parseInt(w.css("fontSize"),10);4>=e?x.find("button.zoom-out").prop("disabled",!0):e>=32?x.find("button.zoom-in").prop("disabled",!0):(x.find("button").prop("disabled",!1),w.removeClass("small x-small")),8>=e&&(w.addClass("small"),4>=e&&w.addClass("x-small"))}function l(e){if(w.is(":visible")){if("zoom-default"==e)w.css("fontSize",V.fsFontSize+"px");else{var t=parseInt(w.css("fontSize"),10);"zoom-in"==e?w.css("fontSize",t+2+"px"):"zoom-out"==e&&w.css("fontSize",t-2+"px")}r()}}function p(e){var t;if("undefined"!=typeof w&&w.is(":visible")?t=w:"undefined"!=typeof g&&g.is(":visible")&&(t=g),"undefined"!=typeof t){var n=t.find("a.hovered");if(n.length){var i=t.next(".tooltip"),a=n[0].getBoundingClientRect(),o=t[0].getBoundingClientRect(),s={top:a.top,right:a.left+o.width,bottom:a.top+o.height,left:a.left,w:a.width,h:a.height},d={top:o.top,right:o.left+o.width,bottom:o.top+o.height,left:o.left,w:o.width,h:o.height};e?i.animate({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)},250):i.css({left:parseInt(s.left+s.w/2-i.outerWidth()/2+7.5,10),top:parseInt(s.top-i.outerHeight()-24,10)}),s.left+s.w/2<d.left||s.right+s.w/2<d.right||s.top+s.h/2<d.top||s.bottom+s.h<d.bottom?i.fadeOut(400):i.fadeIn(250)}}}function c(){if(w.is(":visible")){var e=parseInt(w.css("paddingRight"),10)||0,t=parseInt(w.css("paddingLeft"),10)||0,n=parseInt(w.css("paddingTop"),10)||0,i=parseInt(w.css("paddingBottom"),10)||0,a=parseInt(v.css("paddingRight"),10)||0,o=parseInt(v.css("paddingLeft"),10)||0,s=parseInt(v.css("paddingTop"),10)||0,d=parseInt(v.css("paddingBottom"),10)||0,r=w.children("ol"),l=F;w.css({width:r[0].getBoundingClientRect().width+e+t,width:r[0].getBoundingClientRect().width+e+t,height:r[0].getBoundingClientRect().height+n+i,"max-width":l.width()-a-o,"max-height":l.height()-s-d}),""!=V.sentence&&(w.css("max-height",l.height()-s-d-2*S[0].getBoundingClientRect().height),S.css("max-width",w[0].getBoundingClientRect().width))}}function h(e){errorContainer.children("p").html(e).parent().fadeIn(250),V.normalView&&(g.hide(),m.children(".tv-show-fs").prop("disabled",!0).hide()),V.fsView&&w.hide()}function f(){errorContainer.hide(),w.show(),V.normalView&&m.children(".tv-show-fs").prop("disabled",!1).show()}function u(t){return e(e.map(t,function(e){return e.get()}))}var v,m,w,g,b,y,z,C,x,S,I={normalView:!0,nvFontSize:12,fsView:!0,fsFontSize:14,sentence:"",initFSOnClick:!1,extendedPOS:!1},V=e.extend({},I,n),k=this,F=e(window);V.normalView||V.fsView?(k.children(".tree-visualizer, .tree-visualizer-fs").remove(),i(),a(t)):console.error("Cannot initialize Tree Visualizer: either the container does not exist, or you have set both normal and fullscreen view to false, which does not make sense."),V.initFSOnClick||k.find(".tv-show-fs").click(function(e){C.css("top","-100%").children("ul").empty(),"undefined"!=typeof g&&g.find("a").removeClass("hovered"),v.fadeIn(250),c(),e.preventDefault()}),z.add(F).scroll(function(){p()}),v.click(function(t){var n=e(t.target);n.closest(".tv-error, .tree, .tooltip, .zoom-opts, .sentence").length||(v.fadeOut(250,function(){w.find("a").removeClass("hovered"),f()}),V.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),x.find("button").click(function(){var t=e(this);if(t.is(".close"))v.fadeOut(250,function(){w.find("a").removeClass("hovered"),f()}),V.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{l(t.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]),c();var n=w.find("a.hovered").css("transition-duration")||200;n=String(n).indexOf("ms")>-1?parseFloat(n):1e3*parseFloat(n),n+=50,setTimeout(function(){p(!0)},n)}}),V.fsView&&F.on("resize",c),z.on("click","a",function(t){var n=e(this),i=n.parent("li"),a=i.data(),o=n.closest(".tree"),s=o.find("a"),d=o.next(".tooltip").children("ul");d.empty(),s.removeClass("hovered"),n.addClass("hovered");var r;for(r in a)a.hasOwnProperty(r)&&e("<li>",{html:"<strong>"+r+"</strong>: "+a[r]}).prependTo(d);p(),t.preventDefault()}),z.on("mouseout","a.hovered",function(){var t=e(this);t.closest(".tree").hasClass("small")&&t.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){p(!0)})}),C.find("button").click(function(){var t=e(this),n=t.parent(".tooltip"),i=n.prev(".tree"),a=i.find("a");n.fadeOut(250),a.removeClass("hovered")})}}(jQuery);
